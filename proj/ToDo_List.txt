ToDo_List

- Отображение частоты десятые доли Гц
+ сохранение частоты и коэф. заполнения в EEPROM 
 таймер 1 сек перезапускается по нажатию на кнопки, после записи тамер выкл.
 По 2 копии на частоту и коэф. заполнения.
Brown-out Detector (BOD) обязателен иначе данные в EEPROM при записи могут повредится.

- 2 прерывания TIMER1_OVF_vect если делитель изменился (проверить на глюки, например с ШИМ 1%) 
+ усовершенствовать функцию антидребезга (TIMER2_COMP_vect или в с delay_ms)

- Устойчивость LCD к помехам (искрение при замыкании 600...3000 В на землю через резистор)
Кондуктивная помеха при объединении земли LCD и земли умножителя. 
(1 раз сбросился контроллер, не удалось воспроизвести)
 попробовать задествовать вывод R/W для чтения даннных и сравнения, если появился мусор, 
 то инициализация.
- Меню:
+ вкл. / выкл. выхода (0 В постоянно).
- Выбор PWM / FPM (ШИМ/ЧИМ с ton=const)
- второй канал ШИМ (на триггере + AND)
  программный второй канал ШИМ TOP=ICR1:
  Вместо Fast PWM Mode нужно Phase and Frequency Correct PWM Mode иначе
  будет пауза только по одному фронту,  а не по двум фронтам
  Длительность импульса минимум 2 такта, а не 1 как в Fast PWM Mode
  Период: ICR1 вместо OCR1A, флаг TOV1 вместо OCF1A в TIFR, TOIE1 вместо OCIE1A в TIMSK
  TIMER1_OVF_vect вместо TIMER1_COMPA_vect
  проблемы с обновлением ICR1, когда период около 10 тактов
- Расширение ШИМ до 24...32 бит с помощью прерываний переполнения
- Дискретность частоты сотые доли Гц 
(ограничение на максимальную частоту*10000 uint32_t при вычислении ШИМ)
+ Дискретность ШИМ сотые доли % 
//------------------------------------------------------------------------------
+ коррекция ШИМ и мин. шага ШИМ к реальному значению (при большой частоте)
+ Ограничение на максимальный период
//------------------------------------------------------------------------------
+ отключить подтяжку PB0 во всех прошивках из-за высокого вых. сопротивления фильтра (10 кОм)
  PB1..PB5 - выходы с состоянием 0.
+ заменить if (BTN_state != 0) _delay_ms (300); на цикл с пропуском обработки кнопок
   
+ попробовать словить глюк при изменении делителя Timer1
(синхронизация по 2-му прерыванию)
- оформить комментарии глитча
- Используемые регистры (clobbered registers) в asm вставках button_work()
  (может указать во входных параметрах ?)
+ проверить .lss на регистры.
- Исправить глитч TCNT1>ICR1
	
//------------------------------------------------------------------------------
вместо 
if (Freq>FREQ_MAX_DF1Hz)
if (dFreq>step)
	
//Если T1_OCR=0 ШИМ=0%
//Если T1_OCR=T1_TOP ШИМ=100%

The OCR1A Compare Register will then be updated with the value in the Buffer Register at the next timer clock cycle
the TCNT1 matches TOP. The update is done at the same timer clock cycle as the TCNT1 is cleared and the
TOV1 Flag is set.

//------------------------------------------------------------------------------
  Задержка входа в прерывание 4+3 такта + 1 инструкция (не всегда). 
datasheet: 7.7.1 Interrupt Response Time).
  Т.е. если прерывание пришло во время выполнения инструкции в 1 такт то 
задержка 8 тактов, но получается и 7 тактов, т.е. между инструкциями. 

  Fast PWM Mode. Timer, Overflow Interrupt:  
На осциллограмме видно задержку 8*62,5 нс = 500 нс. Должно быть 9 тактов: 7+ 2 такта инструкция sbi 0x12, 1).

//------------------------------------------------------------------------------
 17.7.3 Using the Output Compare Unit
Do not write the TCNT1 equal to TOP in PWM modes with
variable TOP values. The Compare Match for the TOP will be ignored and the counter will continue to 0xFFFF.
Similarly, do not write the TCNT1 value equal to BOTTOM when the counter is downcounting.

//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
Версии:
 
 ATMega8_PWM_LCD
  0.7 - Исправлена ошибка с dF > 1 Гц (Freq>FREQ_MAX_DF1Hz). 
Т.к. доли Гц не сохраняются, то при уменьшении/увеличении частоты
пересчет Freq=conv_period_freq(); а потом T1_reg_calc(); приводил к невозможности
изменить частоту.
 - Исправлена ошибка отображения 0 кГц вместо 1 МГц
  Версия 0.8 - исправлено в conv_period_freq(): не было перерасчета T1_OCR (OCR1B) при F>F_CPU/100 
Из-за этого коэффициент заполнения ШИМ сильно изменялся при изменении частоты и можно было получить даже 100 %.
(а должен слабо менятся, с учетом ограничений дискретности)
  Версия 0.81 - Кнопка Mode на PB0. Основные настройки в main.h. #define FREQ_MAX (F_CPU/4).
  Версия 0.82 - макс. шаг 10% периода при (Freq>FREQ_MAX_DF1Hz). 
Исправлен глюк при увеличении Freq до FREQ_MAX_DF1Hz+1. Нужно было нажать 2 раза для увеличения 4000 -> 4001 Гц

ATMega8_PWM_2CH_LCD - аналогичные исправления
 
ATMega8_PWM_LCD_E
  ШИМ-генератор с LCD, 2-мя энкодерами и кнопкой
  Версия 0.81 - Кнопка Mode на PB0. Шаг только 1 Гц/1 такт.
  Версия 0.82 - Шаг частоты 1/10/100/1000 Гц. Шаг ШИМ 0,01/ 0,1 / 1 / 5 %. Переключение кнопкой энкодера по кругу.
  (нужно добавить мигание соответствующего разряда неск. сек.)
  Версия 0.83 - исправлено: когда минимальный шаг 0,03% приходилось 3 раза крутить энкодер на 0,01%

 
